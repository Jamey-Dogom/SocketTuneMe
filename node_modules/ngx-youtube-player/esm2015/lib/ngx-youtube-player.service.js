/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, NgZone } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import * as i0 from "@angular/core";
/**
 * @return {?}
 */
export function win() {
    return window;
}
/**
 * @return {?}
 */
export function YouTubeRef() {
    return win()['YT'];
}
/**
 * @return {?}
 */
export function YouTubePlayerRef() {
    return YouTubeRef().Player;
}
/** @type {?} */
export const defaultSizes = {
    height: 270,
    width: 367
};
export class YoutubePlayerService {
    /**
     * @param {?} zone
     */
    constructor(zone) {
        this.zone = zone;
        this.ytApiLoaded = false;
        this.api = new ReplaySubject(1);
        this.createApi();
    }
    /**
     * @param {?} options
     * @return {?}
     */
    loadPlayerApi(options) {
        /** @type {?} */
        const doc = win().document;
        if (!this.ytApiLoaded) {
            this.ytApiLoaded = true;
            /** @type {?} */
            const playerApiScript = doc.createElement('script');
            playerApiScript.type = 'text/javascript';
            playerApiScript.src = `${options.protocol}://www.youtube.com/iframe_api`;
            doc.body.appendChild(playerApiScript);
        }
    }
    /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    setupPlayer(elementId, outputs, sizes, videoId = '', playerVars) {
        /** @type {?} */
        const createPlayer = (/**
         * @return {?}
         */
        () => {
            if (YouTubePlayerRef) {
                this.createPlayer(elementId, outputs, sizes, videoId, playerVars);
            }
        });
        this.api.subscribe(createPlayer);
    }
    /**
     * @param {?} player
     * @return {?}
     */
    play(player) {
        player.playVideo();
    }
    /**
     * @param {?} player
     * @return {?}
     */
    pause(player) {
        player.pauseVideo();
    }
    /**
     * @param {?} media
     * @param {?} player
     * @return {?}
     */
    playVideo(media, player) {
        /** @type {?} */
        const id = media.id.videoId ? media.id.videoId : media.id;
        player.loadVideoById(id);
        this.play(player);
    }
    /**
     * @param {?} player
     * @return {?}
     */
    isPlaying(player) {
        // because YT is not loaded yet 1 is used - YT.PlayerState.PLAYING
        /** @type {?} */
        const isPlayerReady = player && player.getPlayerState;
        /** @type {?} */
        const playerState = isPlayerReady ? player.getPlayerState() : {};
        /** @type {?} */
        const isPlayerPlaying = isPlayerReady
            ? playerState !== YouTubeRef().PlayerState.ENDED &&
                playerState !== YouTubeRef().PlayerState.PAUSED
            : false;
        return isPlayerPlaying;
    }
    /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    createPlayer(elementId, outputs, sizes, videoId = '', playerVars = {}) {
        /** @type {?} */
        const playerSize = {
            height: sizes.height || defaultSizes.height,
            width: sizes.width || defaultSizes.width
        };
        /** @type {?} */
        const ytPlayer = YouTubePlayerRef();
        return new ytPlayer(elementId, Object.assign({}, playerSize, { events: {
                onReady: (/**
                 * @param {?} ev
                 * @return {?}
                 */
                (ev) => {
                    this.zone.run((/**
                     * @return {?}
                     */
                    () => outputs.ready && outputs.ready.next(ev.target)));
                }),
                onStateChange: (/**
                 * @param {?} ev
                 * @return {?}
                 */
                (ev) => {
                    this.zone.run((/**
                     * @return {?}
                     */
                    () => outputs.change && outputs.change.next(ev)));
                })
            }, playerVars,
            videoId }));
    }
    /**
     * @param {?} player
     * @param {?} isFullScreen
     * @return {?}
     */
    toggleFullScreen(player, isFullScreen) {
        let { height, width } = defaultSizes;
        if (!isFullScreen) {
            height = window.innerHeight;
            width = window.innerWidth;
        }
        player.setSize(width, height);
    }
    // adpoted from uid
    /**
     * @return {?}
     */
    generateUniqueId() {
        /** @type {?} */
        const len = 7;
        return Math.random()
            .toString(35)
            .substr(2, len);
    }
    /**
     * @private
     * @return {?}
     */
    createApi() {
        /** @type {?} */
        const onYouTubeIframeAPIReady = (/**
         * @return {?}
         */
        () => {
            if (win()) {
                this.api.next(YouTubeRef());
            }
        });
        win()['onYouTubeIframeAPIReady'] = onYouTubeIframeAPIReady;
    }
}
YoutubePlayerService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
YoutubePlayerService.ctorParameters = () => [
    { type: NgZone }
];
/** @nocollapse */ YoutubePlayerService.ngInjectableDef = i0.defineInjectable({ factory: function YoutubePlayerService_Factory() { return new YoutubePlayerService(i0.inject(i0.NgZone)); }, token: YoutubePlayerService, providedIn: "root" });
if (false) {
    /** @type {?} */
    YoutubePlayerService.prototype.api;
    /**
     * @type {?}
     * @private
     */
    YoutubePlayerService.prototype.ytApiLoaded;
    /**
     * @type {?}
     * @private
     */
    YoutubePlayerService.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gteW91dHViZS1wbGF5ZXIvIiwic291cmNlcyI6WyJsaWIvbmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7Ozs7O0FBR3JDLE1BQU0sVUFBVSxHQUFHO0lBQ2pCLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7Ozs7QUFFRCxNQUFNLFVBQVUsVUFBVTtJQUN4QixPQUFPLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3JCLENBQUM7Ozs7QUFFRCxNQUFNLFVBQVUsZ0JBQWdCO0lBQzlCLE9BQU8sVUFBVSxFQUFFLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUM7O0FBRUQsTUFBTSxPQUFPLFlBQVksR0FBRztJQUMxQixNQUFNLEVBQUUsR0FBRztJQUNYLEtBQUssRUFBRSxHQUFHO0NBQ1g7QUFLRCxNQUFNLE9BQU8sb0JBQW9COzs7O0lBSy9CLFlBQW9CLElBQVk7UUFBWixTQUFJLEdBQUosSUFBSSxDQUFRO1FBRnhCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBRzFCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7Ozs7O0lBRUQsYUFBYSxDQUFDLE9BQWdDOztjQUN0QyxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsUUFBUTtRQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQzs7a0JBQ2xCLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFFB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QUFJLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQztnQkFDakUsQ0FBQyxDQUFBO2FBQ0YsRUFDRCxVQUFVO1lBQ1YsT0FBTyxJQUNQLENBQUM7SUFDTCxDQUFDOzs7Ozs7SUFFRCxnQkFBZ0IsQ0FDZCxNQUFpQixFQUNqQixZQUF3QztZQUVwQyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxZQUFZO1FBRXBDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDakIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7WUFDNUIsS0FBSyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7U0FDM0I7UUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNoQyxDQUFDOzs7OztJQUdELGdCQUFnQjs7Y0FDUixHQUFHLEdBQUcsQ0FBQztRQUNiLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRTthQUNqQixRQUFRLENBQUMsRUFBRSxDQUFDO2FBQ1osTUFBTSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDOzs7OztJQUVPLFNBQVM7O2NBQ1QsdUJBQXVCOzs7UUFBRyxHQUFHLEVBQUU7WUFDbkMsSUFBSSxHQUFHLEVBQUUsRUFBRTtnQkFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO2FBQzdCO1FBQ0gsQ0FBQyxDQUFBO1FBQ0QsR0FBRyxFQUFFLENBQUMseUJBQXlCLENBQUMsR0FBRyx1QkFBdUIsQ0FBQztJQUM3RCxDQUFDOzs7WUF2SEYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBdkJvQixNQUFNOzs7OztJQXlCekIsbUNBQThCOzs7OztJQUU5QiwyQ0FBNEI7Ozs7O0lBRWhCLG9DQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSVBsYXllckFwaVNjcmlwdE9wdGlvbnMsIElQbGF5ZXJPdXRwdXRzLCBJUGxheWVyU2l6ZSB9IGZyb20gJy4vbW9kZWxzJztcblxuZXhwb3J0IGZ1bmN0aW9uIHdpbigpIHtcbiAgcmV0dXJuIHdpbmRvdztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFlvdVR1YmVSZWYoKSB7XG4gIHJldHVybiB3aW4oKVsnWVQnXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFlvdVR1YmVQbGF5ZXJSZWYoKSB7XG4gIHJldHVybiBZb3VUdWJlUmVmKCkuUGxheWVyO1xufVxuXG5leHBvcnQgY29uc3QgZGVmYXVsdFNpemVzID0ge1xuICBoZWlnaHQ6IDI3MCxcbiAgd2lkdGg6IDM2N1xufTtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgWW91dHViZVBsYXllclNlcnZpY2Uge1xuICBhcGk6IFJlcGxheVN1YmplY3Q8WVQuUGxheWVyPjtcblxuICBwcml2YXRlIHl0QXBpTG9hZGVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB6b25lOiBOZ1pvbmUpIHtcbiAgICB0aGlzLmFwaSA9IG5ldyBSZXBsYXlTdWJqZWN0KDEpO1xuICAgIHRoaXMuY3JlYXRlQXBpKCk7XG4gIH1cblxuICBsb2FkUGxheWVyQXBpKG9wdGlvbnM6IElQbGF5ZXJBcGlTY3JpcHRPcHRpb25zKSB7XG4gICAgY29uc3QgZG9jID0gd2luKCkuZG9jdW1lbnQ7XG4gICAgaWYgKCF0aGlzLnl0QXBpTG9hZGVkKSB7XG4gICAgICB0aGlzLnl0QXBpTG9hZGVkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IHBsYXllckFwaVNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHBsYXllckFwaVNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBwbGF5ZXJBcGlTY3JpcHQuc3JjID0gYCR7b3B0aW9ucy5wcm90b2NvbH06Ly93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaWA7XG4gICAgICBkb2MuYm9keS5hcHBlbmRDaGlsZChwbGF5ZXJBcGlTY3JpcHQpO1xuICAgIH1cbiAgfVxuXG4gIHNldHVwUGxheWVyKFxuICAgIGVsZW1lbnRJZDogc3RyaW5nLFxuICAgIG91dHB1dHM6IElQbGF5ZXJPdXRwdXRzLFxuICAgIHNpemVzOiBJUGxheWVyU2l6ZSxcbiAgICB2aWRlb0lkID0gJycsXG4gICAgcGxheWVyVmFyczogWVQuUGxheWVyVmFyc1xuICApIHtcbiAgICBjb25zdCBjcmVhdGVQbGF5ZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoWW91VHViZVBsYXllclJlZikge1xuICAgICAgICB0aGlzLmNyZWF0ZVBsYXllcihlbGVtZW50SWQsIG91dHB1dHMsIHNpemVzLCB2aWRlb0lkLCBwbGF5ZXJWYXJzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYXBpLnN1YnNjcmliZShjcmVhdGVQbGF5ZXIpO1xuICB9XG5cbiAgcGxheShwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcbiAgfVxuXG4gIHBhdXNlKHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgcGxheWVyLnBhdXNlVmlkZW8oKTtcbiAgfVxuXG4gIHBsYXlWaWRlbyhtZWRpYTogYW55LCBwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIGNvbnN0IGlkID0gbWVkaWEuaWQudmlkZW9JZCA/IG1lZGlhLmlkLnZpZGVvSWQgOiBtZWRpYS5pZDtcbiAgICBwbGF5ZXIubG9hZFZpZGVvQnlJZChpZCk7XG4gICAgdGhpcy5wbGF5KHBsYXllcik7XG4gIH1cblxuICBpc1BsYXlpbmcocGxheWVyOiBZVC5QbGF5ZXIpIHtcbiAgICAvLyBiZWNhdXNlIFlUIGlzIG5vdCBsb2FkZWQgeWV0IDEgaXMgdXNlZCAtIFlULlBsYXllclN0YXRlLlBMQVlJTkdcbiAgICBjb25zdCBpc1BsYXllclJlYWR5OiBhbnkgPSBwbGF5ZXIgJiYgcGxheWVyLmdldFBsYXllclN0YXRlO1xuICAgIGNvbnN0IHBsYXllclN0YXRlID0gaXNQbGF5ZXJSZWFkeSA/IHBsYXllci5nZXRQbGF5ZXJTdGF0ZSgpIDoge307XG4gICAgY29uc3QgaXNQbGF5ZXJQbGF5aW5nID0gaXNQbGF5ZXJSZWFkeVxuICAgICAgPyBwbGF5ZXJTdGF0ZSAhPT0gWW91VHViZVJlZigpLlBsYXllclN0YXRlLkVOREVEICYmXG4gICAgICAgIHBsYXllclN0YXRlICE9PSBZb3VUdWJlUmVmKCkuUGxheWVyU3RhdGUuUEFVU0VEXG4gICAgICA6IGZhbHNlO1xuICAgIHJldHVybiBpc1BsYXllclBsYXlpbmc7XG4gIH1cblxuICBjcmVhdGVQbGF5ZXIoXG4gICAgZWxlbWVudElkOiBzdHJpbmcsXG4gICAgb3V0cHV0czogSVBsYXllck91dHB1dHMsXG4gICAgc2l6ZXM6IElQbGF5ZXJTaXplLFxuICAgIHZpZGVvSWQgPSAnJyxcbiAgICBwbGF5ZXJWYXJzOiBZVC5QbGF5ZXJWYXJzID0ge31cbiAgKSB7XG4gICAgY29uc3QgcGxheWVyU2l6ZSA9IHtcbiAgICAgIGhlaWdodDogc2l6ZXMuaGVpZ2h0IHx8IGRlZmF1bHRTaXplcy5oZWlnaHQsXG4gICAgICB3aWR0aDogc2l6ZXMud2lkdGggfHwgZGVmYXVsdFNpemVzLndpZHRoXG4gICAgfTtcbiAgICBjb25zdCB5dFBsYXllciA9IFlvdVR1YmVQbGF5ZXJSZWYoKTtcbiAgICByZXR1cm4gbmV3IHl0UGxheWVyKGVsZW1lbnRJZCwge1xuICAgICAgLi4ucGxheWVyU2l6ZSxcbiAgICAgIGV2ZW50czoge1xuICAgICAgICBvblJlYWR5OiAoZXY6IFlULlBsYXllckV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBvdXRwdXRzLnJlYWR5ICYmIG91dHB1dHMucmVhZHkubmV4dChldi50YXJnZXQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TdGF0ZUNoYW5nZTogKGV2OiBZVC5QbGF5ZXJFdmVudCkgPT4ge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4gb3V0cHV0cy5jaGFuZ2UgJiYgb3V0cHV0cy5jaGFuZ2UubmV4dChldikpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGxheWVyVmFycyxcbiAgICAgIHZpZGVvSWRcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZUZ1bGxTY3JlZW4oXG4gICAgcGxheWVyOiBZVC5QbGF5ZXIsXG4gICAgaXNGdWxsU2NyZWVuOiBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZFxuICApIHtcbiAgICBsZXQgeyBoZWlnaHQsIHdpZHRoIH0gPSBkZWZhdWx0U2l6ZXM7XG5cbiAgICBpZiAoIWlzRnVsbFNjcmVlbikge1xuICAgICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICB9XG4gICAgcGxheWVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7XG4gIH1cblxuICAvLyBhZHBvdGVkIGZyb20gdWlkXG4gIGdlbmVyYXRlVW5pcXVlSWQoKSB7XG4gICAgY29uc3QgbGVuID0gNztcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKVxuICAgICAgLnRvU3RyaW5nKDM1KVxuICAgICAgLnN1YnN0cigyLCBsZW4pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcGkoKSB7XG4gICAgY29uc3Qgb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkgPSAoKSA9PiB7XG4gICAgICBpZiAod2luKCkpIHtcbiAgICAgICAgdGhpcy5hcGkubmV4dChZb3VUdWJlUmVmKCkpO1xuICAgICAgfVxuICAgIH07XG4gICAgd2luKClbJ29uWW91VHViZUlmcmFtZUFQSVJlYWR5J10gPSBvbllvdVR1YmVJZnJhbWVBUElSZWFkeTtcbiAgfVxufVxuIl19