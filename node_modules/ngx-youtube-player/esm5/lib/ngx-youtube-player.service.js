/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, NgZone } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import * as i0 from "@angular/core";
/**
 * @return {?}
 */
export function win() {
    return window;
}
/**
 * @return {?}
 */
export function YouTubeRef() {
    return win()['YT'];
}
/**
 * @return {?}
 */
export function YouTubePlayerRef() {
    return YouTubeRef().Player;
}
/** @type {?} */
export var defaultSizes = {
    height: 270,
    width: 367
};
var YoutubePlayerService = /** @class */ (function () {
    function YoutubePlayerService(zone) {
        this.zone = zone;
        this.ytApiLoaded = false;
        this.api = new ReplaySubject(1);
        this.createApi();
    }
    /**
     * @param {?} options
     * @return {?}
     */
    YoutubePlayerService.prototype.loadPlayerApi = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var doc = win().document;
        if (!this.ytApiLoaded) {
            this.ytApiLoaded = true;
            /** @type {?} */
            var playerApiScript = doc.createElement('script');
            playerApiScript.type = 'text/javascript';
            playerApiScript.src = options.protocol + "://www.youtube.com/iframe_api";
            doc.body.appendChild(playerApiScript);
        }
    };
    /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    YoutubePlayerService.prototype.setupPlayer = /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    function (elementId, outputs, sizes, videoId, playerVars) {
        var _this = this;
        if (videoId === void 0) { videoId = ''; }
        /** @type {?} */
        var createPlayer = (/**
         * @return {?}
         */
        function () {
            if (YouTubePlayerRef) {
                _this.createPlayer(elementId, outputs, sizes, videoId, playerVars);
            }
        });
        this.api.subscribe(createPlayer);
    };
    /**
     * @param {?} player
     * @return {?}
     */
    YoutubePlayerService.prototype.play = /**
     * @param {?} player
     * @return {?}
     */
    function (player) {
        player.playVideo();
    };
    /**
     * @param {?} player
     * @return {?}
     */
    YoutubePlayerService.prototype.pause = /**
     * @param {?} player
     * @return {?}
     */
    function (player) {
        player.pauseVideo();
    };
    /**
     * @param {?} media
     * @param {?} player
     * @return {?}
     */
    YoutubePlayerService.prototype.playVideo = /**
     * @param {?} media
     * @param {?} player
     * @return {?}
     */
    function (media, player) {
        /** @type {?} */
        var id = media.id.videoId ? media.id.videoId : media.id;
        player.loadVideoById(id);
        this.play(player);
    };
    /**
     * @param {?} player
     * @return {?}
     */
    YoutubePlayerService.prototype.isPlaying = /**
     * @param {?} player
     * @return {?}
     */
    function (player) {
        // because YT is not loaded yet 1 is used - YT.PlayerState.PLAYING
        /** @type {?} */
        var isPlayerReady = player && player.getPlayerState;
        /** @type {?} */
        var playerState = isPlayerReady ? player.getPlayerState() : {};
        /** @type {?} */
        var isPlayerPlaying = isPlayerReady
            ? playerState !== YouTubeRef().PlayerState.ENDED &&
                playerState !== YouTubeRef().PlayerState.PAUSED
            : false;
        return isPlayerPlaying;
    };
    /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    YoutubePlayerService.prototype.createPlayer = /**
     * @param {?} elementId
     * @param {?} outputs
     * @param {?} sizes
     * @param {?=} videoId
     * @param {?=} playerVars
     * @return {?}
     */
    function (elementId, outputs, sizes, videoId, playerVars) {
        var _this = this;
        if (videoId === void 0) { videoId = ''; }
        if (playerVars === void 0) { playerVars = {}; }
        /** @type {?} */
        var playerSize = {
            height: sizes.height || defaultSizes.height,
            width: sizes.width || defaultSizes.width
        };
        /** @type {?} */
        var ytPlayer = YouTubePlayerRef();
        return new ytPlayer(elementId, tslib_1.__assign({}, playerSize, { events: {
                onReady: (/**
                 * @param {?} ev
                 * @return {?}
                 */
                function (ev) {
                    _this.zone.run((/**
                     * @return {?}
                     */
                    function () { return outputs.ready && outputs.ready.next(ev.target); }));
                }),
                onStateChange: (/**
                 * @param {?} ev
                 * @return {?}
                 */
                function (ev) {
                    _this.zone.run((/**
                     * @return {?}
                     */
                    function () { return outputs.change && outputs.change.next(ev); }));
                })
            }, playerVars: playerVars,
            videoId: videoId }));
    };
    /**
     * @param {?} player
     * @param {?} isFullScreen
     * @return {?}
     */
    YoutubePlayerService.prototype.toggleFullScreen = /**
     * @param {?} player
     * @param {?} isFullScreen
     * @return {?}
     */
    function (player, isFullScreen) {
        var height = defaultSizes.height, width = defaultSizes.width;
        if (!isFullScreen) {
            height = window.innerHeight;
            width = window.innerWidth;
        }
        player.setSize(width, height);
    };
    // adpoted from uid
    // adpoted from uid
    /**
     * @return {?}
     */
    YoutubePlayerService.prototype.generateUniqueId = 
    // adpoted from uid
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var len = 7;
        return Math.random()
            .toString(35)
            .substr(2, len);
    };
    /**
     * @private
     * @return {?}
     */
    YoutubePlayerService.prototype.createApi = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var onYouTubeIframeAPIReady = (/**
         * @return {?}
         */
        function () {
            if (win()) {
                _this.api.next(YouTubeRef());
            }
        });
        win()['onYouTubeIframeAPIReady'] = onYouTubeIframeAPIReady;
    };
    YoutubePlayerService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    YoutubePlayerService.ctorParameters = function () { return [
        { type: NgZone }
    ]; };
    /** @nocollapse */ YoutubePlayerService.ngInjectableDef = i0.defineInjectable({ factory: function YoutubePlayerService_Factory() { return new YoutubePlayerService(i0.inject(i0.NgZone)); }, token: YoutubePlayerService, providedIn: "root" });
    return YoutubePlayerService;
}());
export { YoutubePlayerService };
if (false) {
    /** @type {?} */
    YoutubePlayerService.prototype.api;
    /**
     * @type {?}
     * @private
     */
    YoutubePlayerService.prototype.ytApiLoaded;
    /**
     * @type {?}
     * @private
     */
    YoutubePlayerService.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gteW91dHViZS1wbGF5ZXIvIiwic291cmNlcyI6WyJsaWIvbmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7OztBQUdyQyxNQUFNLFVBQVUsR0FBRztJQUNqQixPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDOzs7O0FBRUQsTUFBTSxVQUFVLFVBQVU7SUFDeEIsT0FBTyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNyQixDQUFDOzs7O0FBRUQsTUFBTSxVQUFVLGdCQUFnQjtJQUM5QixPQUFPLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQztBQUM3QixDQUFDOztBQUVELE1BQU0sS0FBTyxZQUFZLEdBQUc7SUFDMUIsTUFBTSxFQUFFLEdBQUc7SUFDWCxLQUFLLEVBQUUsR0FBRztDQUNYO0FBRUQ7SUFRRSw4QkFBb0IsSUFBWTtRQUFaLFNBQUksR0FBSixJQUFJLENBQVE7UUFGeEIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFHMUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkIsQ0FBQzs7Ozs7SUFFRCw0Q0FBYTs7OztJQUFiLFVBQWMsT0FBZ0M7O1lBQ3RDLEdBQUcsR0FBRyxHQUFHLEVBQUUsQ0FBQyxRQUFRO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDOztnQkFDbEIsZUFBZSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO1lB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QyxBQXhIRCxJQXdIQztTQXJIWSxvQkFBb0I7OztJQUMvQixtQ0FBOEI7Ozs7O0lBRTlCLDJDQUE0Qjs7Ozs7SUFFaEIsb0NBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJUGxheWVyQXBpU2NyaXB0T3B0aW9ucywgSVBsYXllck91dHB1dHMsIElQbGF5ZXJTaXplIH0gZnJvbSAnLi9tb2RlbHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gd2luKCkge1xuICByZXR1cm4gd2luZG93O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gWW91VHViZVJlZigpIHtcbiAgcmV0dXJuIHdpbigpWydZVCddO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gWW91VHViZVBsYXllclJlZigpIHtcbiAgcmV0dXJuIFlvdVR1YmVSZWYoKS5QbGF5ZXI7XG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0U2l6ZXMgPSB7XG4gIGhlaWdodDogMjcwLFxuICB3aWR0aDogMzY3XG59O1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBZb3V0dWJlUGxheWVyU2VydmljZSB7XG4gIGFwaTogUmVwbGF5U3ViamVjdDxZVC5QbGF5ZXI+O1xuXG4gIHByaXZhdGUgeXRBcGlMb2FkZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xuICAgIHRoaXMuYXBpID0gbmV3IFJlcGxheVN1YmplY3QoMSk7XG4gICAgdGhpcy5jcmVhdGVBcGkoKTtcbiAgfVxuXG4gIGxvYWRQbGF5ZXJBcGkob3B0aW9uczogSVBsYXllckFwaVNjcmlwdE9wdGlvbnMpIHtcbiAgICBjb25zdCBkb2MgPSB3aW4oKS5kb2N1bWVudDtcbiAgICBpZiAoIXRoaXMueXRBcGlMb2FkZWQpIHtcbiAgICAgIHRoaXMueXRBcGlMb2FkZWQgPSB0cnVlO1xuICAgICAgY29uc3QgcGxheWVyQXBpU2NyaXB0ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgcGxheWVyQXBpU2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcbiAgICAgIHBsYXllckFwaVNjcmlwdC5zcmMgPSBgJHtvcHRpb25zLnByb3RvY29sfTovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpYDtcbiAgICAgIGRvYy5ib2R5LmFwcGVuZENoaWxkKHBsYXllckFwaVNjcmlwdCk7XG4gICAgfVxuICB9XG5cbiAgc2V0dXBQbGF5ZXIoXG4gICAgZWxlbWVudElkOiBzdHJpbmcsXG4gICAgb3V0cHV0czogSVBsYXllck91dHB1dHMsXG4gICAgc2l6ZXM6IElQbGF5ZXJTaXplLFxuICAgIHZpZGVvSWQgPSAnJyxcbiAgICBwbGF5ZXJWYXJzOiBZVC5QbGF5ZXJWYXJzXG4gICkge1xuICAgIGNvbnN0IGNyZWF0ZVBsYXllciA9ICgpID0+IHtcbiAgICAgIGlmIChZb3VUdWJlUGxheWVyUmVmKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlUGxheWVyKGVsZW1lbnRJZCwgb3V0cHV0cywgc2l6ZXMsIHZpZGVvSWQsIHBsYXllclZhcnMpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5hcGkuc3Vic2NyaWJlKGNyZWF0ZVBsYXllcik7XG4gIH1cblxuICBwbGF5KHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgcGxheWVyLnBsYXlWaWRlbygpO1xuICB9XG5cbiAgcGF1c2UocGxheWVyOiBZVC5QbGF5ZXIpIHtcbiAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xuICB9XG5cbiAgcGxheVZpZGVvKG1lZGlhOiBhbnksIHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgY29uc3QgaWQgPSBtZWRpYS5pZC52aWRlb0lkID8gbWVkaWEuaWQudmlkZW9JZCA6IG1lZGlhLmlkO1xuICAgIHBsYXllci5sb2FkVmlkZW9CeUlkKGlkKTtcbiAgICB0aGlzLnBsYXkocGxheWVyKTtcbiAgfVxuXG4gIGlzUGxheWluZyhwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIC8vIGJlY2F1c2UgWVQgaXMgbm90IGxvYWRlZCB5ZXQgMSBpcyB1c2VkIC0gWVQuUGxheWVyU3RhdGUuUExBWUlOR1xuICAgIGNvbnN0IGlzUGxheWVyUmVhZHk6IGFueSA9IHBsYXllciAmJiBwbGF5ZXIuZ2V0UGxheWVyU3RhdGU7XG4gICAgY29uc3QgcGxheWVyU3RhdGUgPSBpc1BsYXllclJlYWR5ID8gcGxheWVyLmdldFBsYXllclN0YXRlKCkgOiB7fTtcbiAgICBjb25zdCBpc1BsYXllclBsYXlpbmcgPSBpc1BsYXllclJlYWR5XG4gICAgICA/IHBsYXllclN0YXRlICE9PSBZb3VUdWJlUmVmKCkuUGxheWVyU3RhdGUuRU5ERUQgJiZcbiAgICAgICAgcGxheWVyU3RhdGUgIT09IFlvdVR1YmVSZWYoKS5QbGF5ZXJTdGF0ZS5QQVVTRURcbiAgICAgIDogZmFsc2U7XG4gICAgcmV0dXJuIGlzUGxheWVyUGxheWluZztcbiAgfVxuXG4gIGNyZWF0ZVBsYXllcihcbiAgICBlbGVtZW50SWQ6IHN0cmluZyxcbiAgICBvdXRwdXRzOiBJUGxheWVyT3V0cHV0cyxcbiAgICBzaXplczogSVBsYXllclNpemUsXG4gICAgdmlkZW9JZCA9ICcnLFxuICAgIHBsYXllclZhcnM6IFlULlBsYXllclZhcnMgPSB7fVxuICApIHtcbiAgICBjb25zdCBwbGF5ZXJTaXplID0ge1xuICAgICAgaGVpZ2h0OiBzaXplcy5oZWlnaHQgfHwgZGVmYXVsdFNpemVzLmhlaWdodCxcbiAgICAgIHdpZHRoOiBzaXplcy53aWR0aCB8fCBkZWZhdWx0U2l6ZXMud2lkdGhcbiAgICB9O1xuICAgIGNvbnN0IHl0UGxheWVyID0gWW91VHViZVBsYXllclJlZigpO1xuICAgIHJldHVybiBuZXcgeXRQbGF5ZXIoZWxlbWVudElkLCB7XG4gICAgICAuLi5wbGF5ZXJTaXplLFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgIG9uUmVhZHk6IChldjogWVQuUGxheWVyRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuKCgpID0+IG91dHB1dHMucmVhZHkgJiYgb3V0cHV0cy5yZWFkeS5uZXh0KGV2LnRhcmdldCkpO1xuICAgICAgICB9LFxuICAgICAgICBvblN0YXRlQ2hhbmdlOiAoZXY6IFlULlBsYXllckV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBvdXRwdXRzLmNoYW5nZSAmJiBvdXRwdXRzLmNoYW5nZS5uZXh0KGV2KSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwbGF5ZXJWYXJzLFxuICAgICAgdmlkZW9JZFxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlRnVsbFNjcmVlbihcbiAgICBwbGF5ZXI6IFlULlBsYXllcixcbiAgICBpc0Z1bGxTY3JlZW46IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkXG4gICkge1xuICAgIGxldCB7IGhlaWdodCwgd2lkdGggfSA9IGRlZmF1bHRTaXplcztcblxuICAgIGlmICghaXNGdWxsU2NyZWVuKSB7XG4gICAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIH1cbiAgICBwbGF5ZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIC8vIGFkcG90ZWQgZnJvbSB1aWRcbiAgZ2VuZXJhdGVVbmlxdWVJZCgpIHtcbiAgICBjb25zdCBsZW4gPSA3O1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpXG4gICAgICAudG9TdHJpbmcoMzUpXG4gICAgICAuc3Vic3RyKDIsIGxlbik7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUFwaSgpIHtcbiAgICBjb25zdCBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSA9ICgpID0+IHtcbiAgICAgIGlmICh3aW4oKSkge1xuICAgICAgICB0aGlzLmFwaS5uZXh0KFlvdVR1YmVSZWYoKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB3aW4oKVsnb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHknXSA9IG9uWW91VHViZUlmcmFtZUFQSVJlYWR5O1xuICB9XG59XG4iXX0=